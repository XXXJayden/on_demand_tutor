@page "{id:int}"
@model On_Demand_Tutor_UI.Pages.Student.ViewDetailTutorModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "Tutor Details";
}

<h1 style="text-align: center; color: #2c3e50; font-family: Arial, sans-serif; margin-bottom: 20px; margin-top: 20px">Tutor Details</h1>
<form method="post">
    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 10px; background-color: #f9f9f9; max-width: 800px; margin: 0 auto;">
        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: bold; color: #34495e;">Fullname:</label>
            <span>@Model.TutorDetails.Fullname</span>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: bold; color: #34495e;">Email:</label>
            <span>@Model.TutorDetails.Email</span>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: bold; color: #34495e;">Description:</label>
            <span>@Model.TutorDetails.Description</span>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: bold; color: #34495e;">Major:</label>
            <span>@Model.TutorDetails.Major</span>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: bold; color: #34495e;">Grade:</label>
            <span>@Model.TutorDetails.Grade</span>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: bold; color: #34495e;">Achievements:</label>
            <ul style="list-style-type: none; padding-left: 0;">
                @foreach (var achievement in Model.TutorDetails.Achievements)
                {
                    <li>
                        <img src="@achievement" alt="Achievement Image" style="max-width: 100px; max-height: 100px; margin: 5px;" />
                    </li>
                }
            </ul>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: bold; color: #34495e;">Services:</label>
            <select id="ServiceSelect" name="selectedService" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                @foreach (var service in Model.TutorDetails.Services)
                {
                    <option value="@service.ServiceName">@service.ServiceName - @service.Price.ToString("C")</option>
                }
            </select>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: bold; color: #34495e;">Select Date:</label>
            <input type="date" id="SelectedDate" name="selectedDate" style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; width: 100%;" onchange="fetchAvailableSlots()">
        </div>

        <div style="margin-bottom: 20px;" id="SlotSelection">
            <label style="display: block; font-weight: bold; color: #34495e;">Available Slots:</label>
            <select id="AvailableSlots" name="selectedSlot" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                @foreach (var slot in Model.AvailableSlots)
                {
                    <option value="@slot">@slot</option>
                }
            </select>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: bold; color: #34495e;">Payment Method:</label>
            <select id="PaymentMethod" name="selectedPaymentMethod" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                <option value="Online">Online</option>
                <option value="Offline">Offline</option>
            </select>
        </div>

        <div style="text-align: center;">
            <input type="hidden" asp-for="TutorId" />
            <button type="submit" class="btn btn-primary">Book Now</button>
        </div>
    </div>
</form>

@section Scripts {
    <script>
        async function fetchAvailableSlots() {
            const tutorId = @Model.TutorDetails.TutorId;
            const selectedDate = document.getElementById("SelectedDate").value;

            if (!selectedDate) {
                alert("Please select a date.");
                return;
            }

            const response = await fetch(`?handler=FetchSlots&tutorId=${tutorId}&date=${selectedDate}`);
            const availableSlots = await response.json();

            const slotSelect = document.getElementById("AvailableSlots");
            slotSelect.innerHTML = "";
            availableSlots.forEach(slot => {
                const option = document.createElement("option");
                option.value = slot;
                option.text = slot;
                slotSelect.appendChild(option);
            });
        }
    </script>
}
